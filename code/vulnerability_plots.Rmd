---
title: "Vulnerability Plots"
author: "Grace Kumaishi"
date: "11/29/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)
library(here)
library(ggplot2)
```

```{r}
# Read in data:
gutcheck <- read_csv(here("data", "gutcheck_scores.csv"))
```

```{r}
pi_ac <- gutcheck %>% 
  pivot_wider(names_from = component, values_from = score) %>% 
  select(habitat, species, adaptive_capacity, potential_impact, vulnerability) %>% 
  mutate(vuln_category = case_when(
    vulnerability == "1" ~ "Very Low",
    vulnerability == "2" ~ "Low",
    vulnerability == "3" ~ "Moderate",
    vulnerability == "4" ~ "High",
    vulnerability == "5" ~ "Very High"
  ))
  
```

```{r}
vulnerability <- pi_ac %>% 
  select(habitat, species, vulnerability, vuln_category) %>% 
  group_by(habitat) %>% 
  mutate(count_name_occurr = n()) %>% 
  mutate(habitat = case_when(
    habitat == "pelagic" ~ "Pelagic",
    habitat == "kelp_forest" ~ "Kelp Forest",
    habitat == "rocky_shore" ~ "Rocky Shore",
    habitat == "sandy_seafloor" ~ "Sandy Seafloor",
    habitat == "deep_seafloor" ~ "Deep Seafloor",
    habitat == "sandy_beach" ~ "Sandy Beach"
  ))
```

```{r}
# Specify level order
vulnerability$vuln_category <- factor(vulnerability$vuln_category, levels = c("Low", "Moderate", "High", "Very High"))

ggplot(data = vulnerability, aes(y = reorder(habitat, -count_name_occurr))) +
  geom_bar(width = 0.5, aes(fill = vuln_category), position = position_stack(reverse = TRUE)) +
  scale_fill_manual(breaks = c("Low", "Moderate", "High", "Very High"), values = c("#7ec570", "#ffdc3d", "#ffac3b", "#cd022d")) +
  labs(y = element_blank(),
       x = "Number of Species Assessed",
       title = "Vulnerability Composition of Each Habitat Assessed",
       fill = "Vulnerability Score") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = .5))
```


```{r}
#ggplot(pi_ac, aes(x=potential_impact, y=adaptive_capacity, label = species, color = Vulnerability)) + 
#  geom_point() +
#  geom_text(size = 3, color = "black", position = position_jitter(width = .2, height = .2)) +
#  scale_y_reverse() +
#  geom_jitter(width = .1, height = .1) +
#  scale_color_manual(breaks = c("Low", "Moderate", "High", "Very High"), values = c("forestgreen", "yellow", "orange", "red")) +
#  theme_minimal()
```














